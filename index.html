<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Start</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-bg-hover: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: rgba(255, 255, 255, 0.92);
      --text-secondary: rgba(255, 255, 255, 0.6);
      --text-muted: rgba(255, 255, 255, 0.4);
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --danger: #ef4444;
      --success: #22c55e;
      --warning: #f59e0b;
      --radius: 12px;
      --radius-sm: 8px;
      --blur: 12px;
    }
    [data-theme="light"] {
      --glass-bg: rgba(255, 255, 255, 0.8);
      --glass-bg-hover: rgba(255, 255, 255, 0.95);
      --glass-border: rgba(0, 0, 0, 0.08);
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-primary);
      line-height: 1.5;
    }
    .bg-layer {
      position: fixed; inset: 0; z-index: -1;
      background: #111827;
    }
    .bg-image {
      position: fixed; inset: 0; z-index: -1;
      background-size: cover; background-position: center;
      opacity: 0; transition: opacity 0.8s;
    }
    .bg-image.loaded { opacity: 1; }
    .bg-overlay { position: fixed; inset: 0; z-index: -1; background: transparent; }
    
    /* Light theme */
    [data-theme="light"] .bg-layer { background: #fffbf5; }
    [data-theme="light"] .card { 
      background: #fafafa;
      border: 1px solid #eee;
    }
    [data-theme="light"] .quick-links { 
      background: #fafafa;
      border: 1px solid #eee;
    }
    [data-theme="light"] .quick-link { background: #fff; border: 1px solid #eee; }
    [data-theme="light"] .quick-link:hover { background: #f5f5f5; border-color: #ddd; }
    [data-theme="light"] .quick-link .key { background: #eee; color: var(--text-muted); }
    [data-theme="light"] .countdown-item { background: #fff; border: 1px solid #eee; border-left: 3px solid var(--accent); }
    [data-theme="light"] .todo-item { background: #fff; border: 1px solid #eee; }
    [data-theme="light"] .vocab-stat { background: #fff; border: 1px solid #eee; }
    [data-theme="light"] .vocab-display { background: #fff; border: 1px solid #eee; }
    [data-theme="light"] .todo-tabs { background: #eee; }
    [data-theme="light"] .todo-tab.active { background: #fff; }
    [data-theme="light"] .icon-btn { 
      background: #fafafa;
      border: 1px solid #eee;
    }
    [data-theme="light"] .icon-btn:hover { background: #f5f5f5; }
    [data-theme="light"] .search-box input {
      background: #fafafa;
      border: 1px solid #eee;
    }
    [data-theme="light"] .todo-input {
      background: #fff;
      border: 1px solid #eee;
    }
    [data-theme="light"] .modal {
      background: #fff;
      border: 1px solid #eee;
    }
    [data-theme="light"] .form-input,
    [data-theme="light"] .form-textarea {
      background: #fafafa;
      border: 1px solid #eee;
    }
    [data-theme="light"] .settings-action-btn,
    [data-theme="light"] .export-option {
      background: #fafafa;
      border: 1px solid #eee;
    }
    [data-theme="light"] .settings-action-btn:hover,
    [data-theme="light"] .export-option:hover {
      background: #f5f5f5;
    }
    [data-theme="light"] .add-link-btn,
    [data-theme="light"] .batch-link-btn {
      background: #fff;
      border: 1px solid #eee;
    }
    [data-theme="light"] .vocab-btn {
      background: #fff;
      border: 1px solid #eee;
    }
    [data-theme="light"] .vocab-btn:hover { background: #f5f5f5; }
    [data-theme="light"] .bg-option { border: 2px solid #eee; }
    [data-theme="light"] .bg-option.active { border-color: var(--accent); }

    .container {
      min-height: 100vh; display: flex; flex-direction: column;
      padding: 20px 24px; max-width: 1400px; margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 16px; padding: 8px 0;
    }
    .header-left { display: flex; align-items: center; gap: 20px; }
    .search-box { position: relative; }
    .search-box input {
      width: 200px; padding: 8px 12px 8px 36px;
      background: var(--glass-bg); backdrop-filter: blur(var(--blur));
      border: 1px solid var(--glass-border); border-radius: var(--radius-sm);
      color: var(--text-primary); font-size: 13px; outline: none;
      transition: all 0.2s;
    }
    .search-box input::placeholder { color: var(--text-muted); }
    .search-box input:focus { width: 260px; border-color: var(--accent); }
    .search-box svg {
      position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
      width: 16px; height: 16px; color: var(--text-muted);
    }
    .header-actions { display: flex; gap: 6px; }
    .icon-btn {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      background: var(--glass-bg); backdrop-filter: blur(var(--blur));
      border: 1px solid var(--glass-border); color: var(--text-secondary);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .icon-btn:hover { background: var(--glass-bg-hover); color: var(--text-primary); }

    /* Quick Links Bar */
    .quick-links {
      display: flex; align-items: center; gap: 6px;
      padding: 10px 14px; margin-bottom: 16px;
      background: var(--glass-bg); backdrop-filter: blur(var(--blur));
      border: 1px solid var(--glass-border); border-radius: var(--radius);
      overflow-x: auto; flex-wrap: wrap;
    }
    .quick-link {
      display: flex; align-items: center; gap: 6px;
      padding: 6px 10px; background: rgba(255,255,255,0.05);
      border: 1px solid transparent; border-radius: 8px;
      text-decoration: none; color: var(--text-primary);
      font-size: 12px; font-weight: 500; white-space: nowrap;
      transition: all 0.15s;
    }
    .quick-link:hover { background: rgba(255,255,255,0.1); border-color: var(--accent); }
    .quick-link img { width: 14px; height: 14px; border-radius: 3px; }
    .quick-link .key { font-size: 9px; color: var(--text-muted); background: rgba(255,255,255,0.08); padding: 1px 4px; border-radius: 3px; font-family: monospace; }
    .link-divider { width: 1px; height: 20px; background: var(--glass-border); margin: 0 4px; }
    .add-link-btn {
      width: 28px; height: 28px; border-radius: 6px;
      background: rgba(255,255,255,0.05); border: 1px dashed var(--glass-border);
      color: var(--text-muted); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.15s; flex-shrink: 0;
    }
    .add-link-btn:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); border-style: solid; }
    .batch-link-btn {
      padding: 4px 8px; border-radius: 6px;
      background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
      color: var(--text-muted); cursor: pointer; font-size: 10px;
      transition: all 0.15s; flex-shrink: 0;
    }
    .batch-link-btn:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }

    /* Hero - Left aligned compact */
    .hero {
      display: none;
    }
    
    /* Time in header */
    .header-time {
      display: flex; align-items: center; gap: 16px;
    }
    .clock { font-size: 2.5rem; font-weight: 300; letter-spacing: -1px; color: var(--text-primary); }
    .time-info { display: flex; flex-direction: column; }
    .greeting { font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; }
    .date { font-size: 0.75rem; color: var(--text-muted); }
    [data-theme="light"] .clock { color: #333; }

    /* Dashboard */
    .dashboard {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 14px; flex: 1;
    }
    @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 600px) { .dashboard { grid-template-columns: 1fr; } }

    /* Card */
    .card {
      background: var(--glass-bg); backdrop-filter: blur(var(--blur));
      border: 1px solid var(--glass-border); border-radius: var(--radius);
      padding: 14px; display: flex; flex-direction: column;
      transition: all 0.2s;
    }
    .card:hover { background: var(--glass-bg-hover); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .card-title { font-size: 0.7rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; }
    .card-action {
      width: 24px; height: 24px; border-radius: 6px;
      background: transparent; border: none; color: var(--text-muted);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
    }
    .card-action:hover { background: var(--glass-bg); color: var(--text-primary); }

    /* Countdown */
    .countdown-list { display: flex; flex-direction: column; gap: 8px; }
    .countdown-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px; background: rgba(255,255,255,0.03);
      border-radius: var(--radius-sm); border-left: 3px solid var(--accent);
    }
    .countdown-item.urgent { border-left-color: var(--danger); }
    .countdown-item.soon { border-left-color: var(--warning); }
    .countdown-info { flex: 1; }
    .countdown-name { font-size: 13px; font-weight: 500; }
    .countdown-date { font-size: 11px; color: var(--text-muted); }
    .countdown-days { font-size: 1.3rem; font-weight: 700; color: var(--accent); }
    .countdown-item.urgent .countdown-days { color: var(--danger); }
    .countdown-item.soon .countdown-days { color: var(--warning); }
    .countdown-label { font-size: 10px; color: var(--text-muted); }
    .countdown-delete { opacity: 0; transition: opacity 0.15s; }
    .countdown-item:hover .countdown-delete { opacity: 1; }

    /* Todo */
    .todo-tabs {
      display: flex; gap: 2px; margin-bottom: 10px;
      background: rgba(255,255,255,0.04); padding: 3px; border-radius: 8px;
    }
    .todo-tab {
      flex: 1; padding: 6px; background: transparent; border: none;
      border-radius: 6px; font-size: 11px; font-weight: 500;
      color: var(--text-muted); cursor: pointer;
    }
    .todo-tab.active { background: rgba(255,255,255,0.08); color: var(--text-primary); }
    .todo-input-row { display: flex; gap: 6px; margin-bottom: 8px; }
    .todo-input {
      flex: 1; padding: 8px 10px; background: rgba(255,255,255,0.04);
      border: 1px solid transparent; border-radius: var(--radius-sm);
      color: var(--text-primary); font-size: 13px; outline: none;
    }
    .todo-input:focus { border-color: var(--accent); }
    .todo-input::placeholder { color: var(--text-muted); }
    .todo-add-btn {
      padding: 8px 12px; background: var(--accent); border: none;
      border-radius: var(--radius-sm); color: white; font-size: 12px;
      font-weight: 500; cursor: pointer;
    }
    .todo-add-btn:hover { background: var(--accent-hover); }
    .todo-list { display: flex; flex-direction: column; gap: 4px; max-height: 180px; overflow-y: auto; }
    .todo-item {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 10px; background: rgba(255,255,255,0.03);
      border-radius: var(--radius-sm);
    }
    .todo-checkbox {
      width: 16px; height: 16px; border: 2px solid var(--text-muted);
      border-radius: 50%; cursor: pointer; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
    }
    .todo-checkbox:hover { border-color: var(--accent); }
    .todo-checkbox.checked { background: var(--success); border-color: var(--success); }
    .todo-checkbox.checked::after { content: "âœ“"; color: white; font-size: 10px; }
    .todo-text { flex: 1; font-size: 13px; }
    .todo-item.completed .todo-text { text-decoration: line-through; color: var(--text-muted); }
    .todo-actions { opacity: 0; }
    .todo-item:hover .todo-actions { opacity: 1; }
    .todo-action-btn { width: 20px; height: 20px; border: none; background: transparent; color: var(--text-muted); cursor: pointer; }
    .todo-action-btn:hover { color: var(--danger); }

    /* Vocab */
    .vocab-stats { display: flex; gap: 8px; margin-bottom: 10px; }
    .vocab-stat { flex: 1; text-align: center; padding: 8px; background: rgba(255,255,255,0.03); border-radius: var(--radius-sm); }
    .vocab-stat-value { font-size: 1.1rem; font-weight: 700; color: var(--accent); }
    .vocab-stat-label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; }
    .vocab-display {
      padding: 16px; background: rgba(255,255,255,0.03);
      border-radius: var(--radius-sm); text-align: center;
      margin-bottom: 10px; cursor: pointer; min-height: 90px;
      display: flex; flex-direction: column; justify-content: center;
    }
    .vocab-word { font-size: 1.4rem; font-weight: 600; margin-bottom: 2px; }
    .vocab-phonetic { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; }
    .vocab-meaning { font-size: 13px; color: var(--text-secondary); opacity: 0; transition: opacity 0.2s; }
    .vocab-meaning.show { opacity: 1; }
    .vocab-actions { display: flex; gap: 6px; }
    .vocab-btn {
      flex: 1; padding: 8px; border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm); background: transparent;
      color: var(--text-primary); font-size: 12px; cursor: pointer;
    }
    .vocab-btn:hover { background: rgba(255,255,255,0.08); }
    .vocab-btn.primary { background: var(--accent); border-color: var(--accent); color: white; }
    .vocab-btn.success { background: var(--success); border-color: var(--success); color: white; }
    .vocab-btn.danger { background: var(--danger); border-color: var(--danger); color: white; }

    /* Footer */
    .footer { display: none; }
    .footer-btn { display: none; }
    .footer-btn:hover { color: var(--text-primary); }
    
    /* Settings data actions */
    .settings-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--glass-border); }
    .settings-section-title { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
    .settings-actions { display: flex; flex-direction: column; gap: 8px; }
    .settings-action-btn {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; background: rgba(255,255,255,0.03);
      border: 1px solid var(--glass-border); border-radius: var(--radius-sm);
      color: var(--text-primary); font-size: 13px; cursor: pointer;
      transition: all 0.15s; text-align: left;
    }
    .settings-action-btn:hover { background: rgba(255,255,255,0.06); border-color: var(--accent); }
    .settings-action-btn.danger:hover { border-color: var(--danger); color: var(--danger); }
    .settings-action-icon { font-size: 16px; width: 20px; text-align: center; }

    /* Modal */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      backdrop-filter: blur(6px); display: flex;
      align-items: center; justify-content: center; z-index: 1000;
      opacity: 0; visibility: hidden; transition: all 0.2s;
    }
    .modal-overlay.active { opacity: 1; visibility: visible; }
    .modal {
      background: var(--glass-bg); backdrop-filter: blur(24px);
      border: 1px solid var(--glass-border); border-radius: var(--radius);
      padding: 20px; width: 100%; max-width: 400px;
      transform: scale(0.95); transition: transform 0.2s;
    }
    .modal-overlay.active .modal { transform: scale(1); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .modal-title { font-size: 1rem; font-weight: 600; }
    .modal-close { width: 28px; height: 28px; border: none; background: transparent; color: var(--text-muted); cursor: pointer; border-radius: 6px; }
    .modal-close:hover { background: rgba(255,255,255,0.1); }
    .form-group { margin-bottom: 12px; }
    .form-label { display: block; font-size: 11px; font-weight: 500; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; }
    .form-input {
      width: 100%; padding: 10px; background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border); border-radius: var(--radius-sm);
      color: var(--text-primary); font-size: 13px; outline: none;
    }
    .form-input:focus { border-color: var(--accent); }
    .form-input::placeholder { color: var(--text-muted); }
    .form-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px; }
    .btn { padding: 8px 16px; border-radius: var(--radius-sm); font-size: 13px; cursor: pointer; }
    .btn-secondary { background: transparent; border: 1px solid var(--glass-border); color: var(--text-primary); }
    .btn-primary { background: var(--accent); border: none; color: white; }

    /* Empty */
    .empty-state { text-align: center; padding: 16px; color: var(--text-muted); font-size: 12px; }

    /* Settings BG */
    .bg-selector { display: flex; gap: 6px; flex-wrap: wrap; }
    .bg-option { width: 40px; height: 40px; border-radius: 6px; cursor: pointer; border: 2px solid transparent; }
    .bg-option:hover { transform: scale(1.1); }
    .bg-option.active { border-color: var(--accent); }
    .bg-option.gradient-1 { background: #111827; }
    .bg-option.gradient-2 { background: #1e1b4b; }
    .bg-option.gradient-3 { background: #0c4a6e; }
    .bg-option.gradient-4 { background: #14532d; }
    .bg-option.light-1 { background: #fffbf5; }
    .bg-option.light-2 { background: #fff; }
    .bg-option.light-3 { background: #f8fafc; }
    .bg-option.light-4 { background: #fef7f7; }

    /* Textarea for batch */
    .form-textarea {
      width: 100%; padding: 10px; background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border); border-radius: var(--radius-sm);
      color: var(--text-primary); font-size: 12px; outline: none;
      resize: vertical; min-height: 120px; font-family: inherit; line-height: 1.5;
    }
    .form-textarea:focus { border-color: var(--accent); }
    .form-textarea::placeholder { color: var(--text-muted); }
    .form-hint { font-size: 10px; color: var(--text-muted); margin-top: 4px; }
    
    /* Export options */
    .export-options { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
    .export-option {
      display: flex; align-items: center; gap: 8px;
      padding: 10px; background: rgba(255,255,255,0.03);
      border: 1px solid var(--glass-border); border-radius: var(--radius-sm);
      cursor: pointer; transition: all 0.15s;
    }
    .export-option:hover { background: rgba(255,255,255,0.06); border-color: var(--accent); }
    .export-option-icon { font-size: 18px; }
    .export-option-info { flex: 1; }
    .export-option-title { font-size: 13px; font-weight: 500; }
    .export-option-desc { font-size: 11px; color: var(--text-muted); }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 2px; }
  </style>
</head>
<body>
  <div class="bg-layer"></div>
  <div class="bg-image" id="bgImage"></div>
  <div class="bg-overlay"></div>

  <div class="container">
    <header class="header">
      <div class="header-left">
        <div class="header-time">
          <h1 class="clock" id="clock">12:00</h1>
          <div class="time-info">
            <span class="greeting" id="greeting">ä¸‹åˆå¥½</span>
            <span class="date" id="dateDisplay">2024å¹´1æœˆ1æ—¥ æ˜ŸæœŸä¸€</span>
          </div>
        </div>
        <div class="search-box">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" id="searchInput" placeholder="æœç´¢..." autocomplete="off">
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" id="settingsBtn" title="è®¾ç½®">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>
          </svg>
        </button>
        <button class="icon-btn" id="themeToggle" title="ä¸»é¢˜">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="themeIcon">
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
          </svg>
        </button>
      </div>
    </header>

    <nav class="quick-links" id="quickLinks"></nav>

    <main class="dashboard">
      <section class="card">
        <div class="card-header">
          <span class="card-title">å€’è®¡æ—¶</span>
          <button class="card-action" id="addCountdownBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
          </button>
        </div>
        <div class="countdown-list" id="countdownList"></div>
      </section>

      <section class="card">
        <div class="card-header">
          <span class="card-title">å¾…åŠ</span>
          <button class="card-action" id="archiveTodosBtn" title="å½’æ¡£">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 8v13H3V8M1 3h22v5H1zM10 12h4"/></svg>
          </button>
        </div>
        <div class="todo-tabs">
          <button class="todo-tab active" data-tab="today">ä»Šæ—¥</button>
          <button class="todo-tab" data-tab="week">æœ¬å‘¨</button>
          <button class="todo-tab" data-tab="later">ç¨å</button>
        </div>
        <div class="todo-input-row">
          <input type="text" class="todo-input" id="todoInput" placeholder="æ–°ä»»åŠ¡...">
          <button class="todo-add-btn" id="addTodoBtn">+</button>
        </div>
        <div class="todo-list" id="todoList"></div>
      </section>

      <section class="card">
        <div class="card-header">
          <span class="card-title">å•è¯</span>
          <button class="card-action" id="manageVocabBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v18M3 9l9-6 9 6M3 15l9 6 9-6"/></svg>
          </button>
        </div>
        <div class="vocab-stats">
          <div class="vocab-stat"><div class="vocab-stat-value" id="vocabNew">0</div><div class="vocab-stat-label">æ–°</div></div>
          <div class="vocab-stat"><div class="vocab-stat-value" id="vocabReview">0</div><div class="vocab-stat-label">å¤ä¹ </div></div>
          <div class="vocab-stat"><div class="vocab-stat-value" id="vocabMastered">0</div><div class="vocab-stat-label">æŒæ¡</div></div>
        </div>
        <div class="vocab-display" id="vocabDisplay">
          <div class="vocab-word" id="vocabWord">-</div>
          <div class="vocab-phonetic" id="vocabPhonetic"></div>
          <div class="vocab-meaning" id="vocabMeaning">ç‚¹å‡»æ˜¾ç¤º</div>
        </div>
        <div class="vocab-actions" id="vocabActions"></div>
      </section>
    </main>

    <footer class="footer" style="display:none">
      <input type="file" id="importFileInputOld" accept=".json" style="display:none">
    </footer>
  </div>

  <!-- Link Modal -->
  <div class="modal-overlay" id="linkModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">æ·»åŠ é“¾æ¥</h3>
        <button class="modal-close" id="closeLinkModal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </div>
      <div class="form-group"><label class="form-label">åç§°</label><input type="text" class="form-input" id="linkName" placeholder="ç½‘ç«™åç§°"></div>
      <div class="form-group"><label class="form-label">URL</label><input type="url" class="form-input" id="linkUrl" placeholder="https://..."></div>
      <div class="form-group"><label class="form-label">å¿«æ·é”®</label><input type="text" class="form-input" id="linkKey" placeholder="å•å­—æ¯" maxlength="1"></div>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelLinkBtn">å–æ¶ˆ</button>
        <button class="btn btn-primary" id="saveLinkBtn">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- Countdown Modal -->
  <div class="modal-overlay" id="countdownModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">æ·»åŠ å€’è®¡æ—¶</h3>
        <button class="modal-close" id="closeCountdownModal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </div>
      <div class="form-group"><label class="form-label">åç§°</label><input type="text" class="form-input" id="countdownName" placeholder="äº‹ä»¶åç§°"></div>
      <div class="form-group"><label class="form-label">æ—¥æœŸ</label><input type="date" class="form-input" id="countdownDate"></div>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelCountdownBtn">å–æ¶ˆ</button>
        <button class="btn btn-primary" id="saveCountdownBtn">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- Vocab Modal -->
  <div class="modal-overlay" id="vocabModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ç®¡ç†è¯åº“</h3>
        <button class="modal-close" id="closeVocabModal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </div>
      <div class="form-group"><label class="form-label">æ·»åŠ å•è¯ï¼ˆæ¯è¡Œï¼šå•è¯ | éŸ³æ ‡ | é‡Šä¹‰ï¼‰</label><textarea class="form-input" id="vocabInput" rows="5" placeholder="word | /phonetic/ | meaning"></textarea></div>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelVocabBtn">å–æ¶ˆ</button>
        <button class="btn btn-primary" id="saveVocabBtn">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- Batch Link Modal -->
  <div class="modal-overlay" id="batchLinkModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">æ‰¹é‡æ·»åŠ é“¾æ¥</h3>
        <button class="modal-close" id="closeBatchLinkModal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </div>
      <div class="form-group">
        <label class="form-label">é“¾æ¥åˆ—è¡¨</label>
        <textarea class="form-textarea" id="batchLinkInput" placeholder="GitHub | https://github.com | g&#10;Google | https://google.com | s&#10;Twitter | https://twitter.com"></textarea>
        <p class="form-hint">æ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼Œæ ¼å¼ï¼šåç§° | URL | å¿«æ·é”®ï¼ˆå¯é€‰ï¼‰</p>
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelBatchLinkBtn">å–æ¶ˆ</button>
        <button class="btn btn-primary" id="saveBatchLinkBtn">å¯¼å…¥</button>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div class="modal-overlay" id="exportModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">å¯¼å‡ºæ•°æ®</h3>
        <button class="modal-close" id="closeExportModal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </div>
      <div class="export-options">
        <div class="export-option" id="exportAll">
          <span class="export-option-icon">ğŸ“¦</span>
          <div class="export-option-info">
            <div class="export-option-title">å¯¼å‡ºå…¨éƒ¨æ•°æ®</div>
            <div class="export-option-desc">åŒ…å«é“¾æ¥ã€å€’è®¡æ—¶ã€å¾…åŠã€è¯åº“å’Œè®¾ç½®</div>
          </div>
        </div>
        <div class="export-option" id="exportLinks">
          <span class="export-option-icon">ğŸ”—</span>
          <div class="export-option-info">
            <div class="export-option-title">ä»…å¯¼å‡ºé“¾æ¥</div>
            <div class="export-option-desc">çº¯æ–‡æœ¬æ ¼å¼ï¼Œæ–¹ä¾¿åˆ†äº«</div>
          </div>
        </div>
        <div class="export-option" id="exportVocab">
          <span class="export-option-icon">ğŸ“š</span>
          <div class="export-option-info">
            <div class="export-option-title">ä»…å¯¼å‡ºè¯åº“</div>
            <div class="export-option-desc">åŒ…å«å­¦ä¹ è¿›åº¦çš„è¯åº“æ•°æ®</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">è®¾ç½®</h3>
        <button class="modal-close" id="closeSettingsModal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </div>
      <div class="form-group">
        <label class="form-label">æš—è‰²èƒŒæ™¯</label>
        <div class="bg-selector" id="bgSelector">
          <div class="bg-option gradient-1 active" data-bg="gradient-1" title="æ·±é‚ƒå¤œç©º"></div>
          <div class="bg-option gradient-2" data-bg="gradient-2" title="ç¥ç§˜ç´«å¤œ"></div>
          <div class="bg-option gradient-3" data-bg="gradient-3" title="æ·±æµ·è“"></div>
          <div class="bg-option gradient-4" data-bg="gradient-4" title="æš—å¤œæ£®æ—"></div>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">äº®è‰²èƒŒæ™¯</label>
        <div class="bg-selector">
          <div class="bg-option light-1" data-bg="light-1" title="å†·ç°"></div>
          <div class="bg-option light-2" data-bg="light-2" title="æš–ç±³"></div>
          <div class="bg-option light-3" data-bg="light-3" title="é›¾è“"></div>
          <div class="bg-option light-4" data-bg="light-4" title="å¥¶èŒ¶"></div>
        </div>
      </div>
      <div class="form-group"><label class="form-label">è‡ªå®šä¹‰èƒŒæ™¯URL</label><input type="url" class="form-input" id="customBgUrl" placeholder="https://..."></div>
      <div class="settings-section">
        <div class="settings-section-title">æ•°æ®ç®¡ç†</div>
        <div class="settings-actions">
          <button class="settings-action-btn" id="exportDataBtn"><span class="settings-action-icon">ğŸ“¦</span>å¯¼å‡ºå…¨éƒ¨æ•°æ®</button>
          <button class="settings-action-btn" id="importDataBtn"><span class="settings-action-icon">ğŸ“¥</span>å¯¼å…¥æ•°æ®</button>
          <button class="settings-action-btn danger" id="clearDataBtn"><span class="settings-action-icon">ğŸ—‘ï¸</span>æ¸…é™¤æœ¬åœ°å­˜å‚¨</button>
        </div>
      </div>
      <input type="file" id="importFileInput" accept=".json" style="display:none">
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'startpage_data';
    const defaultData = {
      theme: 'dark', background: 'gradient-1', customBg: '',
      links: [
        // AI Assistants
        { name: 'ChatGPT', url: 'https://chat.openai.com', key: 'c' },
        { name: 'Claude', url: 'https://claude.ai', key: 'a' },
        { name: 'Gemini', url: 'https://gemini.google.com', key: 'e' },
        { name: 'Perplexity', url: 'https://perplexity.ai', key: 'p' },
        { name: 'Poe', url: 'https://poe.com', key: '' },
        // AI Tools
        { name: 'Midjourney', url: 'https://midjourney.com', key: 'm' },
        { name: 'Runway', url: 'https://runwayml.com', key: '' },
        { name: 'ElevenLabs', url: 'https://elevenlabs.io', key: '' },
        { name: 'Hugging Face', url: 'https://huggingface.co', key: 'h' },
        // Dev
        { name: 'GitHub', url: 'https://github.com', key: 'g' },
        { name: 'Vercel', url: 'https://vercel.com', key: 'v' },
        { name: 'Cursor', url: 'https://cursor.com', key: '' },
        // Search & Social
        { name: 'Google', url: 'https://google.com', key: 's' },
        { name: 'X', url: 'https://x.com', key: 'x' },
        { name: 'YouTube', url: 'https://youtube.com', key: 'y' },
        { name: 'Reddit', url: 'https://reddit.com', key: 'r' }
      ],
      countdowns: [
        { name: 'å…ƒæ—¦', date: '2026-01-01' },
        { name: 'æ˜¥èŠ‚', date: '2026-02-17' },
        { name: 'æ¸…æ˜èŠ‚', date: '2026-04-05' },
        { name: 'åŠ³åŠ¨èŠ‚', date: '2026-05-01' },
        { name: 'ç«¯åˆèŠ‚', date: '2026-06-19' },
        { name: 'ä¸­ç§‹èŠ‚', date: '2026-09-27' },
        { name: 'å›½åº†èŠ‚', date: '2026-10-01' }
      ],
      todos: {
        today: [
          { text: 'é˜…è¯» Anthropic æŠ€æœ¯åšå®¢', completed: false },
          { text: 'æµ‹è¯• Claude API æ–°åŠŸèƒ½', completed: false },
          { text: 'æ•´ç† AI å·¥å…·æ”¶è—å¤¹', completed: true }
        ],
        week: [
          { text: 'å­¦ä¹  LangChain æ¡†æ¶', completed: false },
          { text: 'æ­å»ºæœ¬åœ° LLM ç¯å¢ƒ', completed: false }
        ],
        later: [
          { text: 'ç ”ç©¶ RAG æœ€ä½³å®è·µ', completed: false },
          { text: 'å†™ä¸€ç¯‡ AI å·¥å…·å¯¹æ¯”æ–‡ç« ', completed: false }
        ]
      },
      vocab: {
        words: [
          { word: 'hallucination', phonetic: '/hÉ™ËŒluËsÉªËˆneÉªÊƒn/', meaning: 'AI å¹»è§‰ï¼Œç”Ÿæˆè™šå‡ä¿¡æ¯', interval: 1, repetition: 0, easeFactor: 2.5, nextReview: null },
          { word: 'emergent', phonetic: '/ÉªËˆmÉœËdÊ’É™nt/', meaning: 'æ¶Œç°çš„ï¼ˆèƒ½åŠ›ï¼‰', interval: 1, repetition: 0, easeFactor: 2.5, nextReview: null },
          { word: 'fine-tuning', phonetic: '/faÉªn ËˆtjuËnÉªÅ‹/', meaning: 'å¾®è°ƒï¼Œç²¾è°ƒæ¨¡å‹', interval: 1, repetition: 0, easeFactor: 2.5, nextReview: null },
          { word: 'inference', phonetic: '/ËˆÉªnfÉ™rÉ™ns/', meaning: 'æ¨ç†ï¼Œæ¨¡å‹æ¨æ–­', interval: 1, repetition: 0, easeFactor: 2.5, nextReview: null },
          { word: 'tokenization', phonetic: '/ËŒtoÊŠkÉ™naÉªËˆzeÉªÊƒn/', meaning: 'åˆ†è¯ï¼Œæ ‡è®°åŒ–', interval: 1, repetition: 0, easeFactor: 2.5, nextReview: null },
          { word: 'embedding', phonetic: '/ÉªmËˆbedÉªÅ‹/', meaning: 'åµŒå…¥ï¼Œå‘é‡è¡¨ç¤º', interval: 1, repetition: 0, easeFactor: 2.5, nextReview: null }
        ],
        dailyNew: 5, todayLearned: []
      }
    };
    let data = loadData();
    function loadData() {
      try {
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        const merged = { ...defaultData, ...saved };
        // Deep merge nested objects
        merged.todos = { ...defaultData.todos, ...(saved.todos || {}) };
        merged.vocab = { ...defaultData.vocab, ...(saved.vocab || {}) };
        return merged;
      } catch { return JSON.parse(JSON.stringify(defaultData)); }
    }
    function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
    function el(id) { return document.getElementById(id); }
    function ce(tag, cls, txt) { const e = document.createElement(tag); if (cls) e.className = cls; if (txt) e.textContent = txt; return e; }
    function svg(d, w=14, h=14) {
      const s = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      s.setAttribute('width', w); s.setAttribute('height', h); s.setAttribute('viewBox', '0 0 24 24');
      s.setAttribute('fill', 'none'); s.setAttribute('stroke', 'currentColor'); s.setAttribute('stroke-width', '2');
      const p = document.createElementNS('http://www.w3.org/2000/svg', 'path'); p.setAttribute('d', d); s.appendChild(p); return s;
    }

    // Clock
    function updateClock() {
      const now = new Date(), h = now.getHours(), m = String(now.getMinutes()).padStart(2, '0');
      el('clock').textContent = h + ':' + m;
      el('greeting').textContent = h < 12 ? 'æ—©ä¸Šå¥½' : h < 18 ? 'ä¸‹åˆå¥½' : 'æ™šä¸Šå¥½';
      el('dateDisplay').textContent = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
    }

    // Theme
    function initTheme() {
      document.documentElement.setAttribute('data-theme', data.theme || 'dark');
      el('themeIcon').innerHTML = data.theme === 'light' ? '<circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>' : '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
    }
    function toggleTheme() {
      data.theme = data.theme === 'dark' ? 'light' : 'dark';
      // Auto switch background to match theme
      if (data.theme === 'light' && data.background && data.background.startsWith('gradient-')) {
        data.background = 'light-1';
      } else if (data.theme === 'dark' && data.background && data.background.startsWith('light-')) {
        data.background = 'gradient-1';
      }
      saveData(); initTheme(); initBg();
    }

    // Background
    function initBg() {
      const layer = document.querySelector('.bg-layer'), img = el('bgImage');
      if (data.customBg) { img.style.backgroundImage = 'url(' + data.customBg + ')'; img.classList.add('loaded'); }
      else {
        const g = {
          'gradient-1': '#111827',
          'gradient-2': '#1e1b4b',
          'gradient-3': '#0c4a6e',
          'gradient-4': '#14532d',
          'light-1': '#fffbf5',
          'light-2': '#fff',
          'light-3': '#f8fafc',
          'light-4': '#fef7f7'
        };
        // Auto-correct background if theme doesn't match
        const isLightTheme = data.theme === 'light';
        const isLightBg = data.background && data.background.startsWith('light-');
        if (isLightTheme && !isLightBg) {
          data.background = 'light-1';
          saveData();
        } else if (!isLightTheme && isLightBg) {
          data.background = 'gradient-1';
          saveData();
        }
        layer.style.background = g[data.background] || (isLightTheme ? g['light-1'] : g['gradient-1']);
      }
      document.querySelectorAll('.bg-option').forEach(o => o.classList.toggle('active', o.dataset.bg === data.background));
    }

    // Quick Links
    function renderLinks(filter = '') {
      const c = el('quickLinks'); c.replaceChildren();
      data.links.filter(l => !filter || l.name.toLowerCase().includes(filter.toLowerCase())).forEach(link => {
        const a = ce('a', 'quick-link'); a.href = link.url; a.target = '_blank'; a.dataset.key = link.key || '';
        const img = document.createElement('img');
        try { img.src = 'https://www.google.com/s2/favicons?domain=' + new URL(link.url).hostname + '&sz=32'; } catch {}
        a.appendChild(img); a.appendChild(ce('span', '', link.name));
        if (link.key) a.appendChild(ce('span', 'key', link.key));
        c.appendChild(a);
      });
      const addBtn = ce('button', 'add-link-btn'); addBtn.innerHTML = '+'; addBtn.onclick = () => openModal('linkModal'); c.appendChild(addBtn);
      const batchBtn = ce('button', 'batch-link-btn', 'æ‰¹é‡'); batchBtn.onclick = () => openModal('batchLinkModal'); c.appendChild(batchBtn);
    }
    function addLink() {
      const name = el('linkName').value.trim(), url = el('linkUrl').value.trim(), key = el('linkKey').value.trim().toLowerCase();
      if (!name || !url) return alert('è¯·å¡«å†™åç§°å’ŒURL');
      data.links.push({ name, url, key }); saveData(); renderLinks(); closeModal('linkModal');
      ['linkName', 'linkUrl', 'linkKey'].forEach(id => el(id).value = '');
    }

    // Countdown
    function renderCountdowns() {
      const c = el('countdownList'); c.replaceChildren(); const now = new Date();
      if (!data.countdowns.length) { c.appendChild(ce('div', 'empty-state', 'æš‚æ— ')); return; }
      [...data.countdowns].sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(item => {
        const idx = data.countdowns.indexOf(item), diff = Math.ceil((new Date(item.date) - now) / 864e5);
        const d = ce('div', 'countdown-item' + (diff <= 3 ? ' urgent' : diff <= 7 ? ' soon' : ''));
        const info = ce('div', 'countdown-info'); info.appendChild(ce('div', 'countdown-name', item.name)); info.appendChild(ce('div', 'countdown-date', item.date));
        const time = ce('div', 'countdown-time'); time.appendChild(ce('div', 'countdown-days', diff > 0 ? diff : 'è¿‡æœŸ')); time.appendChild(ce('div', 'countdown-label', diff > 0 ? 'å¤©' : ''));
        const del = ce('button', 'card-action countdown-delete'); del.appendChild(svg('M18 6L6 18M6 6l12 12')); del.onclick = () => { data.countdowns.splice(idx, 1); saveData(); renderCountdowns(); };
        d.appendChild(info); d.appendChild(time); d.appendChild(del); c.appendChild(d);
      });
    }
    function addCountdown() {
      const name = el('countdownName').value.trim(), date = el('countdownDate').value;
      if (!name || !date) return alert('è¯·å¡«å†™');
      data.countdowns.push({ name, date }); saveData(); renderCountdowns(); closeModal('countdownModal');
      el('countdownName').value = ''; el('countdownDate').value = '';
    }

    // Todo
    let curTab = 'today';
    function renderTodos() {
      const c = el('todoList'); c.replaceChildren(); const todos = data.todos[curTab] || [];
      if (!todos.length) { c.appendChild(ce('div', 'empty-state', 'æš‚æ— ')); return; }
      todos.forEach((t, i) => {
        const d = ce('div', 'todo-item' + (t.completed ? ' completed' : ''));
        const cb = ce('div', 'todo-checkbox' + (t.completed ? ' checked' : '')); cb.onclick = () => { data.todos[curTab][i].completed = !t.completed; saveData(); renderTodos(); };
        const txt = ce('span', 'todo-text', t.text);
        const act = ce('div', 'todo-actions'); const del = ce('button', 'todo-action-btn'); del.appendChild(svg('M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2'));
        del.onclick = () => { data.todos[curTab].splice(i, 1); saveData(); renderTodos(); }; act.appendChild(del);
        d.appendChild(cb); d.appendChild(txt); d.appendChild(act); c.appendChild(d);
      });
    }
    function addTodo() {
      const txt = el('todoInput').value.trim();
      if (!txt) return;
      if (!data.todos[curTab]) data.todos[curTab] = []; // Safety check
      data.todos[curTab].unshift({ text: txt, completed: false });
      saveData(); renderTodos(); el('todoInput').value = '';
    }
    function switchTab(t) { curTab = t; document.querySelectorAll('.todo-tab').forEach(e => e.classList.toggle('active', e.dataset.tab === t)); renderTodos(); }
    function archiveTodos() { Object.keys(data.todos).forEach(t => data.todos[t] = data.todos[t].filter(x => !x.completed)); saveData(); renderTodos(); }

    // Vocab
    let wordIdx = 0, showMeaning = false, words = [];
    function getReview() { return data.vocab.words.filter(w => !w.nextReview || new Date(w.nextReview) <= new Date()); }
    function getNew() {
      const today = new Date().toDateString();
      if (data.vocab.todayDate !== today) { data.vocab.todayDate = today; data.vocab.todayLearned = []; saveData(); }
      return data.vocab.words.filter(w => !w.nextReview && !data.vocab.todayLearned.includes(w.word)).slice(0, data.vocab.dailyNew - data.vocab.todayLearned.length);
    }
    function updateStats() { el('vocabNew').textContent = getNew().length; el('vocabReview').textContent = getReview().length; el('vocabMastered').textContent = data.vocab.words.filter(w => w.repetition >= 5).length; }
    function vocabBtns(mode) {
      const c = el('vocabActions'); c.replaceChildren();
      if (mode === 'init') {
        const show = ce('button', 'vocab-btn', 'æ˜¾ç¤º'); show.onclick = toggleMean;
        const next = ce('button', 'vocab-btn primary', 'ä¸‹ä¸€ä¸ª'); next.onclick = nextWord;
        c.appendChild(show); c.appendChild(next);
      } else {
        const f = ce('button', 'vocab-btn danger', 'å¿˜äº†'); f.onclick = () => rate(1);
        const m = ce('button', 'vocab-btn', 'æ¨¡ç³Š'); m.onclick = () => rate(3);
        const k = ce('button', 'vocab-btn success', 'è®°ä½'); k.onclick = () => rate(5);
        c.appendChild(f); c.appendChild(m); c.appendChild(k);
      }
    }
    function nextWord() {
      words = [...getReview(), ...getNew()];
      if (!words.length) { el('vocabWord').textContent = 'å®Œæˆ!'; el('vocabPhonetic').textContent = ''; el('vocabMeaning').textContent = 'æ˜å¤©ç»§ç»­'; el('vocabMeaning').classList.add('show'); el('vocabActions').replaceChildren(); return; }
      wordIdx = Math.floor(Math.random() * words.length);
      const w = words[wordIdx]; el('vocabWord').textContent = w.word; el('vocabPhonetic').textContent = w.phonetic || ''; el('vocabMeaning').textContent = w.meaning; el('vocabMeaning').classList.remove('show'); showMeaning = false; vocabBtns('init');
    }
    function toggleMean() { showMeaning = !showMeaning; el('vocabMeaning').classList.toggle('show', showMeaning); if (showMeaning) vocabBtns('rate'); }
    function rate(q) {
      const w = words[wordIdx]; if (!w) return;
      if (q < 3) { w.repetition = 0; w.interval = 1; } else { w.interval = w.repetition === 0 ? 1 : w.repetition === 1 ? 6 : Math.round(w.interval * w.easeFactor); w.repetition++; }
      w.easeFactor = Math.max(1.3, w.easeFactor + (0.1 - (5-q)*(0.08+(5-q)*0.02)));
      const nr = new Date(); nr.setDate(nr.getDate() + w.interval); w.nextReview = nr.toISOString();
      if (!data.vocab.todayLearned.includes(w.word)) data.vocab.todayLearned.push(w.word);
      saveData(); updateStats(); nextWord();
    }
    function addVocab() {
      const input = el('vocabInput').value.trim(); if (!input) return;
      input.split('\n').filter(l => l.trim()).forEach(line => {
        const p = line.split('|').map(x => x.trim());
        if (p.length >= 2 && !data.vocab.words.find(w => w.word === p[0])) data.vocab.words.push({ word: p[0], phonetic: p[1] || '', meaning: p[2] || p[1], interval: 1, repetition: 0, easeFactor: 2.5, nextReview: null });
      });
      saveData(); updateStats(); nextWord(); closeModal('vocabModal'); el('vocabInput').value = '';
    }

    // Modal
    function openModal(id) { el(id).classList.add('active'); }
    function closeModal(id) { el(id).classList.remove('active'); }

    // Settings
    function saveSett() { const bg = el('customBgUrl').value.trim(); if (bg) { data.customBg = bg; data.background = ''; } saveData(); initBg(); closeModal('settingsModal'); }
    function clearData() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
      }
    }

    // Batch Links
    function addBatchLinks() {
      const input = el('batchLinkInput').value.trim(); if (!input) return;
      let added = 0;
      input.split('\n').filter(l => l.trim()).forEach(line => {
        const p = line.split('|').map(x => x.trim());
        if (p.length >= 2 && p[1].startsWith('http')) {
          const name = p[0], url = p[1], key = (p[2] || '').toLowerCase().slice(0, 1);
          if (!data.links.find(l => l.url === url)) { data.links.push({ name, url, key }); added++; }
        }
      });
      saveData(); renderLinks(); closeModal('batchLinkModal'); el('batchLinkInput').value = '';
      if (added > 0) alert('æˆåŠŸæ·»åŠ  ' + added + ' ä¸ªé“¾æ¥');
    }

    // Import/Export
    function exportAll() {
      const exportData = {
        version: '1.0',
        exportDate: new Date().toISOString(),
        data: {
          theme: data.theme,
          background: data.background,
          customBg: data.customBg,
          links: data.links,
          countdowns: data.countdowns,
          todos: data.todos,
          vocab: data.vocab
        }
      };
      const b = new Blob([JSON.stringify(exportData, null, 2)], {type:'application/json'}), u = URL.createObjectURL(b), a = document.createElement('a');
      a.href = u; a.download = 'startpage-backup-' + new Date().toISOString().slice(0,10) + '.json'; a.click(); URL.revokeObjectURL(u);
      closeModal('exportModal');
    }
    function exportLinks() {
      const txt = data.links.map(l => l.name + ' | ' + l.url + (l.key ? ' | ' + l.key : '')).join('\n');
      const b = new Blob([txt], {type:'text/plain'}), u = URL.createObjectURL(b), a = document.createElement('a');
      a.href = u; a.download = 'startpage-links.txt'; a.click(); URL.revokeObjectURL(u);
      closeModal('exportModal');
    }
    function exportVocab() {
      const exportData = {
        version: '1.0',
        exportDate: new Date().toISOString(),
        vocab: data.vocab
      };
      const b = new Blob([JSON.stringify(exportData, null, 2)], {type:'application/json'}), u = URL.createObjectURL(b), a = document.createElement('a');
      a.href = u; a.download = 'startpage-vocab-' + new Date().toISOString().slice(0,10) + '.json'; a.click(); URL.revokeObjectURL(u);
      closeModal('exportModal');
    }
    function importD(f) {
      const r = new FileReader(); r.onload = e => {
        try {
          const imported = JSON.parse(e.target.result);
          // Handle new format with version
          if (imported.version && imported.data) {
            data = {...defaultData, ...imported.data};
          } else if (imported.version && imported.vocab) {
            // Vocab only import
            data.vocab = imported.vocab;
          } else {
            // Legacy format
            data = {...defaultData, ...imported};
          }
          saveData(); location.reload();
        } catch { alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯'); }
      }; r.readAsText(f);
    }

    // Keys
    document.addEventListener('keydown', e => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); el('searchInput').focus(); return; }
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      if (e.metaKey || e.ctrlKey || e.altKey) return; // Don't trigger shortcuts with modifier keys
      const link = document.querySelector('.quick-link[data-key="' + e.key.toLowerCase() + '"]');
      if (link) { e.preventDefault(); window.open(link.href, '_blank'); }
    });

    // Events
    el('themeToggle').onclick = toggleTheme;
    el('searchInput').oninput = e => renderLinks(e.target.value);
    el('saveLinkBtn').onclick = addLink;
    el('closeLinkModal').onclick = () => closeModal('linkModal');
    el('cancelLinkBtn').onclick = () => closeModal('linkModal');
    el('addCountdownBtn').onclick = () => openModal('countdownModal');
    el('saveCountdownBtn').onclick = addCountdown;
    el('closeCountdownModal').onclick = () => closeModal('countdownModal');
    el('cancelCountdownBtn').onclick = () => closeModal('countdownModal');
    document.querySelectorAll('.todo-tab').forEach(t => t.onclick = () => switchTab(t.dataset.tab));
    el('todoInput').onkeypress = e => { if (e.key === 'Enter') addTodo(); };
    el('addTodoBtn').onclick = addTodo;
    el('archiveTodosBtn').onclick = archiveTodos;
    el('manageVocabBtn').onclick = () => openModal('vocabModal');
    el('saveVocabBtn').onclick = addVocab;
    el('closeVocabModal').onclick = () => closeModal('vocabModal');
    el('cancelVocabBtn').onclick = () => closeModal('vocabModal');
    el('vocabDisplay').onclick = () => { if (!showMeaning && words.length) toggleMean(); };
    el('settingsBtn').onclick = () => openModal('settingsModal');
    el('closeSettingsModal').onclick = () => closeModal('settingsModal');
    document.querySelectorAll('.bg-option').forEach(o => o.onclick = () => {
      document.querySelectorAll('.bg-option').forEach(x => x.classList.remove('active')); o.classList.add('active');
      data.background = o.dataset.bg; data.customBg = ''; el('customBgUrl').value = '';
      // Auto switch theme based on background
      const isLight = o.dataset.bg.startsWith('light-');
      if (isLight && data.theme !== 'light') { data.theme = 'light'; initTheme(); }
      else if (!isLight && data.theme !== 'dark') { data.theme = 'dark'; initTheme(); }
      saveData(); initBg();
    });
    el('exportDataBtn').onclick = () => openModal('exportModal');
    el('closeExportModal').onclick = () => closeModal('exportModal');
    el('exportAll').onclick = exportAll;
    el('exportLinks').onclick = exportLinks;
    el('exportVocab').onclick = exportVocab;
    el('closeBatchLinkModal').onclick = () => closeModal('batchLinkModal');
    el('cancelBatchLinkBtn').onclick = () => closeModal('batchLinkModal');
    el('saveBatchLinkBtn').onclick = addBatchLinks;
    el('importDataBtn').onclick = () => el('importFileInput').click();
    el('importFileInput').onchange = e => { if (e.target.files[0]) importD(e.target.files[0]); };
    el('clearDataBtn').onclick = clearData;
    document.querySelectorAll('.modal-overlay').forEach(o => o.onclick = e => { if (e.target === o) closeModal(o.id); });
    document.onkeydown = e => { if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.active').forEach(m => closeModal(m.id)); };

    // Init
    initTheme(); initBg(); updateClock(); renderLinks(); renderCountdowns(); renderTodos(); updateStats(); nextWord();
    setInterval(updateClock, 1000); setInterval(renderCountdowns, 60000);
  </script>
</body>
</html>
